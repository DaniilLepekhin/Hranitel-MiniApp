# ‚úÖ –ì–û–¢–û–í–û –ö –ó–ê–ü–£–°–ö–£ - –ö–û–î –î–ï–ù–ï–ì 4.0

**–î–∞—Ç–∞:** 14 —è–Ω–≤–∞—Ä—è 2026
**–°—Ç–∞—Ç—É—Å:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∞, –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–π

---

## üéâ –ß–¢–û –°–î–ï–õ–ê–ù–û:

### 1. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `club_hranitel` —Å–æ–∑–¥–∞–Ω–∞
- **–°–µ—Ä–≤–µ—Ä:** 31.128.36.81:5423
- **–ë–∞–∑–∞:** club_hranitel
- **User:** postgres
- **Pass:** U3S%fZ(D2cru

### 2. ‚úÖ Schema.ts —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ (10 –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü)

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ `ep_transactions` - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Energy Points
- ‚úÖ `shop_items` - —Ç–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞
- ‚úÖ `shop_purchases` - –ø–æ–∫—É–ø–∫–∏
- ‚úÖ `teams` - –î–µ—Å—è—Ç–∫–∏ (–∫–æ–º–∞–Ω–¥—ã)
- ‚úÖ `team_members` - —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥
- ‚úÖ `live_streams` - –ø—Ä—è–º—ã–µ —ç—Ñ–∏—Ä—ã
- ‚úÖ `stream_attendance` - –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å —ç—Ñ–∏—Ä–æ–≤
- ‚úÖ `weekly_reports` - –Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
- ‚úÖ `user_keys` - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ 12 –∫–ª—é—á–∞–º

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
- ‚úÖ `users` - –¥–æ–±–∞–≤–ª–µ–Ω—ã `energyPoints` –∏ `metadata`
- ‚úÖ `courses` - –¥–æ–±–∞–≤–ª–µ–Ω—ã `keyNumber`, `monthTheme`, `unlockCondition`

### 3. ‚úÖ Docker Compose –æ–±–Ω–æ–≤–ª–µ–Ω
- –£–±—Ä–∞–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î (31.128.36.81:5423)
- Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- Backend + Frontend –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–ø—É—Å–∫—É

### 4. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `.env.example` —Å–æ–∑–¥–∞–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨:

### **–®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î**

```bash
cd backend

# –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
cp .env.example .env

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã)
bun run db:push

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
bun run db:studio
```

### **–®–∞–≥ 2: –ó–∞–ø–æ–ª–Ω–∏—Ç—å seed –¥–∞–Ω–Ω—ã–µ**

```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞
bun run seed:shop

# –°–æ–∑–¥–∞—Ç—å 12 –∫–ª—é—á–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
bun run seed:keys
```

### **–®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f backend
docker-compose logs -f webapp
```

### **–®–∞–≥ 4: Deploy –Ω–∞ —Å–µ—Ä–≤–µ—Ä 2.58.98.41**

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (2.58.98.41)
ssh root@2.58.98.41

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url> /var/www/club_webapp
cd /var/www/club_webapp

# –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
nano .env
# (–≤—Å—Ç–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ .env.example)

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps
docker-compose logs -f
```

---

## üìä –°–¢–†–£–ö–¢–£–†–ê –ë–î:

### **Enums:**
```typescript
ep_transaction_type: 'income' | 'expense'
shop_category: 'elite' | 'secret' | 'savings'
shop_item_type: 'raffle_ticket' | 'lesson' | 'discount'
stream_status: 'scheduled' | 'live' | 'ended'
```

### **–¢–∞–±–ª–∏—Ü—ã Users:**
```sql
users
  + energyPoints: integer (NEW)
  + metadata: jsonb (NEW - –¥–ª—è metka –∏–∑ —Å—Ç–∞—Ä–æ–π –ë–î)
```

### **–¢–∞–±–ª–∏—Ü—ã Courses:**
```sql
courses
  + keyNumber: integer (1-12)
  + monthTheme: text
  + unlockCondition: jsonb
```

### **–ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
1. **ep_transactions** - –∏—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è/—Å–ø–∏—Å–∞–Ω–∏—è EP
2. **shop_items** - –≤–∏—Ç—Ä–∏–Ω–∞ –º–∞–≥–∞–∑–∏–Ω–∞ (3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
3. **shop_purchases** - –ø–æ–∫—É–ø–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **teams** - –î–µ—Å—è—Ç–∫–∏ (6-12 —á–µ–ª–æ–≤–µ–∫)
5. **team_members** - —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–µ—Å—è—Ç–æ–∫
6. **live_streams** - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —ç—Ñ–∏—Ä–æ–≤
7. **stream_attendance** - –∫—Ç–æ –±—ã–ª –Ω–∞ —ç—Ñ–∏—Ä–µ
8. **weekly_reports** - –æ—Ç—á–µ—Ç—ã –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è–º
9. **user_keys** - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ 12 –∫–ª—é—á–∞–º

---

## üî• –¢–†–ò–ì–ì–ï–†–´ –ù–ê–ß–ò–°–õ–ï–ù–ò–Ø EP (–∏–∑ –¢–ó):

| –î–µ–π—Å—Ç–≤–∏–µ | EP | –£—Å–ª–æ–≤–∏–µ |
|----------|-----|---------|
| –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≤—Ö–æ–¥ | +10 | 1 —Ä–∞–∑ –≤ 24 —á–∞—Å–∞ |
| –ü—Ä–æ—Å–º–æ—Ç—Ä —É—Ä–æ–∫–∞ | +50 | >80% –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |
| –í–æ—Å–∫—Ä–µ—Å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ | +50 | –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ/–∑–∞–ø–∏—Å—å |
| –ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä | +100 | –û–Ω–ª–∞–π–Ω (–Ω–µ –∑–∞–ø–∏—Å—å) |
| –û—Ç—á–µ—Ç –Ω–µ–¥–µ–ª–∏ | +100 | –î–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è 23:59 |
| –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ | +300 | –ê–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–µ |
| –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ—Å—è—Ü–∞ | +500 | 100% —É—Ä–æ–∫–æ–≤ + 4 –æ—Ç—á–µ—Ç–∞ |

---

## üõçÔ∏è –í–ò–¢–†–ò–ù–ê –ú–ê–ì–ê–ó–ò–ù–ê (seed –¥–∞–Ω–Ω—ã–µ):

### **–ö–∞—Ç–µ–≥–æ—Ä–∏—è 1: –≠–ª–∏—Ç–Ω—ã–π —à–∞–Ω—Å**
```typescript
{
  title: "–ë–∏–ª–µ—Ç –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à —Ä–∞–∑–±–æ—Ä–∞",
  category: "elite",
  price: 1000, // EP
  itemType: "raffle_ticket"
}
```

### **–ö–∞—Ç–µ–≥–æ—Ä–∏—è 2: –¢–∞–π–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞**
```typescript
{
  title: "–£—Ä–æ–∫: –ú–∞–≥–∏—è –°–≤–µ—á–µ–π",
  category: "secret",
  price: 600,
  itemType: "lesson"
},
{
  title: "–£—Ä–æ–∫: –°–µ–∫—Å –∏ –õ–∏–±–∏–¥–æ",
  category: "secret",
  price: 800,
  itemType: "lesson"
}
```

### **–ö–∞—Ç–µ–≥–æ—Ä–∏—è 3: –ö–æ–ø–∏–ª–∫–∞**
```typescript
{
  title: "–°–∫–∏–¥–∫–∞ 1000‚ÇΩ –Ω–∞ –ò–Ω—Å—Ç–∏—Ç—É—Ç",
  category: "savings",
  price: 3000,
  itemType: "discount"
},
{
  title: "–ú–µ—Å—è—Ü –∫–ª—É–±–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫",
  category: "savings",
  price: 5000,
  itemType: "discount"
}
```

---

## ‚ö†Ô∏è –ß–¢–û –û–°–¢–ê–õ–û–°–¨ –î–û–î–ï–õ–ê–¢–¨:

### **Backend Services (2-3 –¥–Ω—è):**
1. Energy Points —Å–µ—Ä–≤–∏—Å
   - `POST /api/ep/award` - –Ω–∞—á–∏—Å–ª–∏—Ç—å EP
   - `POST /api/ep/spend` - —Å–ø–∏—Å–∞—Ç—å EP
   - `GET /api/ep/balance` - –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
   - `GET /api/ep/history` - –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

2. Shop —Å–µ—Ä–≤–∏—Å
   - `GET /api/shop/items` - —Ç–æ–≤–∞—Ä—ã
   - `POST /api/shop/purchase` - –∫—É–ø–∏—Ç—å
   - `GET /api/shop/purchases` - –º–æ–∏ –ø–æ–∫—É–ø–∫–∏

3. Teams —Å–µ—Ä–≤–∏—Å
   - `GET /api/teams/my` - –º–æ—è –¥–µ—Å—è—Ç–∫–∞
   - `GET /api/teams/:id/members` - —É—á–∞—Å—Ç–Ω–∏–∫–∏

4. Streams —Å–µ—Ä–≤–∏—Å
   - `GET /api/streams/upcoming` - –±–ª–∏–∂–∞–π—à–∏–µ —ç—Ñ–∏—Ä—ã
   - `POST /api/streams/:id/attend` - –æ—Ç–º–µ—Ç–∏—Ç—å—Å—è –Ω–∞ —ç—Ñ–∏—Ä–µ

5. Reports —Å–µ—Ä–≤–∏—Å
   - `POST /api/reports/submit` - —Å–¥–∞—Ç—å –æ—Ç—á–µ—Ç
   - `GET /api/reports/deadline` - –∫–æ–≥–¥–∞ –¥–µ–¥–ª–∞–π–Ω

### **Frontend (2-3 –¥–Ω—è):**
1. –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é (5 —Ç–∞–±–æ–≤ –≤–º–µ—Å—Ç–æ 6)
2. –°–æ–∑–¥–∞—Ç—å —ç–∫—Ä–∞–Ω "–ú–∞–≥–∞–∑–∏–Ω"
3. –°–æ–∑–¥–∞—Ç—å —ç–∫—Ä–∞–Ω "–ß–∞—Ç—ã" (–î–µ—Å—è—Ç–∫–∏)
4. –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å "–ö—É—Ä—Å—ã" ‚Üí "–ü—É—Ç—å" (12 –ö–ª—é—á–µ–π)
5. –í–∏–¥–∂–µ—Ç—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π (EP –±–∞–ª–∞–Ω—Å, —ç—Ñ–∏—Ä—ã)

### **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (1 –¥–µ–Ω—å):**
1. –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (54K)
2. –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–ª–ª–æ–≤ (1.7M —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
3. –°–∫—Ä–∏–ø—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –î–µ—Å—è—Ç–∫–∞–º

---

## üìû –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏** - —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î
2. **Seed –¥–∞–Ω–Ω—ã–µ** - –∑–∞–ø–æ–ª–Ω–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä–∞–º–∏
3. **–°–æ–∑–¥–∞—Ç—å Backend Services** - API –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
4. **–û–±–Ω–æ–≤–∏—Ç—å Frontend** - –Ω–æ–≤—ã–µ —ç–∫—Ä–∞–Ω—ã –ø–æ –¢–ó
5. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ** - –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–∞–ª–ª—ã
6. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã EP
7. **Deploy** - –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

---

## üí° –í–ê–ñ–ù–û:

### **Connection Strings:**
```bash
# –ù–æ–≤–∞—è –ë–î (club_hranitel)
DATABASE_URL=postgresql://postgres:U3S%fZ(D2cru@31.128.36.81:5423/club_hranitel

# –°—Ç–∞—Ä–∞—è –ë–î (postgres) - –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
OLD_DATABASE_URL=postgresql://postgres:U3S%fZ(D2cru@31.128.36.81:5423/postgres
```

### **–°–µ—Ä–≤–µ—Ä—ã:**
```bash
# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
ssh root@2.58.98.41  # pass: 6gNJOtZexhZG2nQwiamOYxUx

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
ssh root@31.128.36.81  # pass: U3S%fZ(D2cru
```

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** 14 —è–Ω–≤–∞—Ä—è 2026
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–π –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–µ—Ä–≤–∏—Å–æ–≤
**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 30% (–ë–î –≥–æ—Ç–æ–≤–∞, –æ—Å—Ç–∞–ª–æ—Å—å Backend + Frontend + –ú–∏–≥—Ä–∞—Ü–∏—è)
