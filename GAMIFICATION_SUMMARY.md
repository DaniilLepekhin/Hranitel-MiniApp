# üéÆ –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìä –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: `energy_transactions`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å—Ö–µ–º—ã:** `backend/src/db/schema.ts:279`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∏ —Å–ø–∏—Å–∞–Ω–∏—è Energy Points

**–ü–æ–ª—è:**
- `id` - UUID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `userId` - UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (FK ‚Üí users.id)
- `amount` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–Ω–µ—Ä–≥–∏–∏ (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ)
- `type` - –¢–∏–ø: 'income' (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ) –∏–ª–∏ 'expense' (—Å–ø–∏—Å–∞–Ω–∏–µ)
- `reason` - –ü—Ä–∏—á–∏–Ω–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (—Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- `metadata` - JSON —Å –¥–æ–ø. –¥–∞–Ω–Ω—ã–º–∏ (hashtag, chat_type, lessonId –∏ —Ç.–¥.)
- `expiresAt` - –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ (6 –º–µ—Å—è—Ü–µ–≤ –ø–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è)
- `isExpired` - –§–ª–∞–≥ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤
- `createdAt` - –î–∞—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

**–ò–Ω–¥–µ–∫—Å—ã:**
- –ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –¥–∞—Ç–µ, —Ç–∏–ø—É, –¥–∞—Ç–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è

---

## üí∞ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ—Å–º–æ—Ç—Ä —É—Ä–æ–∫–∞ (+20 EP)
- **–§–∞–π–ª:** `backend/src/modules/energy-points/service.ts:222`
- **–í—ã–∑–æ–≤:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–∫–∞
- **–ó–∞—â–∏—Ç–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ `metadata->>'lessonId'`
- **–õ–∏–º–∏—Ç:** 1 —Ä–∞–∑ –Ω–∞ —É—Ä–æ–∫ (–Ω–∞–≤—Å–µ–≥–¥–∞)

### 2. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç (+50 EP)
- **–§–∞–π–ª:** `backend/src/services/hashtag-parser.service.ts:35-42`
- **–¢—Ä–∏–≥–≥–µ—Ä:** –•–µ—à—Ç–µ–≥–∏ `#–æ—Ç—á–µ—Ç` –∏–ª–∏ `#–¥–∑` –≤ —á–∞—Ç–µ –¥–µ—Å—è—Ç–∫–∏
- **–õ–∏–º–∏—Ç:** 1 —Ä–∞–∑ –≤ 20 —á–∞—Å–æ–≤
- **–†–µ–∞–∫—Ü–∏—è:** ‚ö° + –õ–°

### 3. –ò–Ω—Å–∞–π—Ç / –û—Ç–∑—ã–≤ (+40 EP)
- **–§–∞–π–ª:** `backend/src/services/hashtag-parser.service.ts:56-62`
- **–¢—Ä–∏–≥–≥–µ—Ä:** –•–µ—à—Ç–µ–≥ `#–∏–Ω—Å–∞–π—Ç` –≤ —á–∞—Ç–µ –≥–æ—Ä–æ–¥–∞
- **–õ–∏–º–∏—Ç:** –ú–∞–∫—Å–∏–º—É–º 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é
- **–†–µ–∞–∫—Ü–∏—è:** ‚ù§ + –õ–°

### 4. –û—Ç–º–µ—Ç–∫–∞ –≤ Stories (+200 EP)
- **–§–∞–π–ª:** `backend/src/services/hashtag-parser.service.ts:27`
- **–¢—Ä–∏–≥–≥–µ—Ä:** –•–µ—à—Ç–µ–≥ `#—Å—Ç–æ—Ä–∏—Å` + –º–µ–¥–∏–∞ –≤ —á–∞—Ç–µ –≥–æ—Ä–æ–¥–∞
- **–õ–∏–º–∏—Ç:** 1 —Ä–∞–∑ –≤ 3 –¥–Ω—è
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ
- **–†–µ–∞–∫—Ü–∏—è:** ‚ù§ + –õ–°

### 5. –£—á–∞—Å—Ç–∏–µ –≤ –°–æ–∑–≤–æ–Ω–µ (+100 EP)
- **–§–∞–π–ª:** `backend/src/services/hashtag-parser.service.ts:26`
- **–¢—Ä–∏–≥–≥–µ—Ä:** –•–µ—à—Ç–µ–≥ `#—Å–æ–∑–≤–æ–Ω` + –º–µ–¥–∏–∞ –≤ —á–∞—Ç–µ –≥–æ—Ä–æ–¥–∞
- **–õ–∏–º–∏—Ç:** 1 —Ä–∞–∑ –≤ 3 –¥–Ω—è
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ
- **–†–µ–∞–∫—Ü–∏—è:** ‚ù§ + –õ–°

### 6. –°–æ–∑–≤–æ–Ω + Stories - –ö–û–ú–ë–û (+300 EP)
- **–§–∞–π–ª:** `backend/src/services/hashtag-parser.service.ts:24`
- **–¢—Ä–∏–≥–≥–µ—Ä:** –•–µ—à—Ç–µ–≥–∏ `#—Å–æ–∑–≤–æ–Ω #—Å—Ç–æ—Ä–∏—Å` –≤–º–µ—Å—Ç–µ + –º–µ–¥–∏–∞
- **–õ–∏–º–∏—Ç:** 1 —Ä–∞–∑ –≤ 3 –¥–Ω—è
- **–ë–æ–Ω—É—Å:** +100 EP –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ä–∞–∑–¥–µ–ª—å–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- **–†–µ–∞–∫—Ü–∏—è:** ‚ù§ + –õ–°

### 7. –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ (+500 EP)
- **–§–∞–π–ª:** `backend/src/modules/energy-points/service.ts:265`
- **–í—ã–∑–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
  - –ü—Ä–∏ –æ–ø–ª–∞—Ç–µ —á–µ—Ä–µ–∑ Lava: `backend/src/modules/webhooks/lava-payment.ts:361`
  - –í—Ä—É—á–Ω—É—é –∞–¥–º–∏–Ω–æ–º: `backend/src/modules/admin/index.ts:503`
- **–õ–∏–º–∏—Ç:** –ù–µ—Ç (–∫–∞–∂–¥–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ)

### 8. –°—É–±–±–æ—Ç–Ω—è—è –ø—Ä–∞–∫—Ç–∏–∫–∞ (+50 EP)
- **–§–∞–π–ª:** `backend/src/services/hashtag-parser.service.ts:48-54`
- **–¢—Ä–∏–≥–≥–µ—Ä:** –•–µ—à—Ç–µ–≥ `#–ø—Ä–∞–∫—Ç–∏–∫–∞` + –º–µ–¥–∏–∞ –≤ —á–∞—Ç–µ –≥–æ—Ä–æ–¥–∞
- **–õ–∏–º–∏—Ç:** 1 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** 
  - –¢–æ–ª—å–∫–æ —Å—É–±–±–æ—Ç–∞/–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
  - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ
- **–†–µ–∞–∫—Ü–∏—è:** ‚ù§ + –õ–°

---

## üì± –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### RatingsTab.tsx - –í–∫–ª–∞–¥–∫–∞ "–†–µ–π—Ç–∏–Ω–≥–∏ / –±–∞–ª–ª—ã"
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. **–ö–∞—Ä—Ç–æ—á–∫–∞ –±–∞–ª–∞–Ω—Å–∞** (—Å—Ç—Ä–æ–∫–∞ 290)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
   - –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É
   
2. **–ö–Ω–æ–ø–∫–∞ "–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π"** (—Å—Ç—Ä–æ–∫–∞ 309)
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ

### EnergyHistoryModal.tsx - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
**–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –ü—Ä–∏—á–∏–Ω—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (reason)
- –°—É–º–º—É —Å –∏–∫–æ–Ω–∫–æ–π ‚ö°
- –î–∞—Ç—É –∏ –≤—Ä–µ–º—è
- lessonId (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –°—Ä–æ–∫ –∏—Å—Ç–µ—á–µ–Ω–∏—è –±–∞–ª–ª–æ–≤

---

## üóÑÔ∏è –¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (production)

```
–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç       - 269 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π = 13,450 EP
–ò–Ω—Å–∞–π—Ç / –û—Ç–∑—ã–≤         - 115 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π = 4,600 EP
–û—Ç–º–µ—Ç–∫–∞ –≤ Stories      - 63 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏  = 12,600 EP
–ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏     - 47 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  = 23,500 EP
–£—á–∞—Å—Ç–∏–µ –≤ –°–æ–∑–≤–æ–Ω–µ      - 20 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  = 2,000 EP
–°–æ–∑–≤–æ–Ω + Stories       - 1 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è   = 300 EP
–ü—Ä–æ—Å–º–æ—Ç—Ä —É—Ä–æ–∫–∞         - 85 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  = 1,700 EP
–ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ (–¥–Ω–∏ 1-4) - 930 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π = 18,600 EP

–ò–¢–û–ì–û: 1,530 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ —Å—É–º–º—É 76,750 Energy Points
```

---

## ‚úÖ –ö—É—Ä—Å –æ–±–Ω–æ–≤–ª—ë–Ω

**–ë—ã–ª–æ:** "–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫ —Å–µ–±–µ"  
**–°—Ç–∞–ª–æ:** "–î–µ–Ω—å–≥–∏ –ø–æ-–∂–µ–Ω—Å–∫–∏: –∫–æ–¥ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏"

**–ú–∏–≥—Ä–∞—Ü–∏—è:** `backend/migrations/[timestamp]_update_course_title.sql`
